<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BerniePOS</title>
  <style>
    body {
      font-family: Arial;
      margin: 0;
      padding: 0;
      background: #f8f8f8;
    }
    header, footer {
      background: #2d2d2d;
      color: white;
      padding: 10px;
      text-align: center;
    }
    .container {
      padding: 20px;
    }
    .product {
      display: inline-block;
      width: 150px;
      margin: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 0 5px #ccc;
    }
    .product img {
      width: 100px;
      height: 100px;
    }
    #cart {
      margin-top: 20px;
    }
    #cart table {
      width: 100%;
      border-collapse: collapse;
    }
    #cart th, #cart td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    .form-section {
      margin-top: 20px;
    }
    .form-section input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
    }
    #qr {
      display: none;
      text-align: center;
    }
    #qr img {
      width: 200px;
    }
    .btn {
      background: #2d2d2d;
      color: white;
      padding: 10px 20px;
      border: none;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>Bernie POS</h1>
  </header>

  <div class="container">
    <h2>Products</h2>
    <div id="product-list-container"></div>

    <div id="cart">
      <h3>Cart</h3>
      <table>
        <thead>
          <tr><th>Item</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr>
        </thead>
        <tbody id="product-list"></tbody>
        <tfoot>
          <tr><td colspan="3"><strong>Total</strong></td><td id="total">₱0</td></tr>
        </tfoot>
      </table>
    </div>

    <div class="form-section">
      <h3>Customer Details</h3>
      <input type="text" id="customerName" placeholder="Name" required>
      <input type="tel" id="customerPhone" placeholder="Phone Number" required>
      <textarea id="customerAddress" placeholder="Address" required></textarea>

      <h4>Payment Method</h4>
      <label><input type="radio" name="paymentMethod" value="COD" checked> Cash on Delivery (COD)</label><br>
      <label><input type="radio" name="paymentMethod" value="GCash"> GCash</label>

      <div id="qr">
        <p>Scan to pay with GCash:</p>
        <img src="img/qrcode.png" alt="GCash QR Code">
      </div>

      <button class="btn" onclick="sendToTelegram()">Send Order</button>
    </div>
  </div>

  <footer>
    &copy; 2025 BerniePOS
  </footer>

  <script>
    const TELEGRAM_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwcdylyg3lfnJrBfo2TFAlnGlw7a1rHZpc3yRNub3pvbRi_yjudAXn3pR-m7lgEIiTfNQ/exec";

    const products = [
      { name: "Dishwashing Liquid", price: 25, img: "img/dish.png" },
      { name: "Laundry Soap", price: 20, img: "img/laundry.png" },
      { name: "Siomai", price: 5, img: "img/siomai.png" },
      { name: "Lumpia", price: 5, img: "img/lumpia.png" }
    ];

    const cart = {};

    function renderProducts() {
      const container = document.getElementById("product-list-container");
      products.forEach((product, i) => {
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <img src="${product.img}" alt="${product.name}">
          <p>${product.name}</p>
          <p>₱${product.price}</p>
          <button class="btn" onclick="addToCart(${i})">Add</button>
        `;
        container.appendChild(div);
      });
    }

    function addToCart(index) {
      const product = products[index];
      if (!cart[product.name]) {
        cart[product.name] = { qty: 1, price: product.price };
      } else {
        cart[product.name].qty++;
      }
      renderCart();
    }

    function renderCart() {
      const tbody = document.getElementById("product-list");
      tbody.innerHTML = "";
      let total = 0;
      for (let name in cart) {
        const item = cart[name];
        const subtotal = item.qty * item.price;
        total += subtotal;
        tbody.innerHTML += `
          <tr>
            <td class="item-name">${name}</td>
            <td class="item-qty">${item.qty}</td>
            <td class="item-price">${item.price}</td>
            <td>₱${subtotal}</td>
          </tr>
        `;
      }
      document.getElementById("total").textContent = "₱" + total;
    }

    document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
      radio.addEventListener("change", () => {
        const qr = document.getElementById("qr");
        qr.style.display = (radio.value === "GCash" && radio.checked) ? "block" : "none";
      });
    });

    function sendToTelegram() {
      const name = document.getElementById("customerName").value;
      const phone = document.getElementById("customerPhone").value;
      const address = document.getElementById("customerAddress").value;
      const payment = document.querySelector('input[name="paymentMethod"]:checked').value;

      const rows = document.querySelectorAll("#product-list tr");
      let items = [];
      let total = 0;

      rows.forEach(row => {
        const itemName = row.querySelector(".item-name").textContent;
        const qty = parseInt(row.querySelector(".item-qty").textContent);
        const price = parseFloat(row.querySelector(".item-price").textContent);
        items.push({ name: itemName, qty, price });
        total += qty * price;
      });

      const data = {
        name,
        phone,
        address,
        payment,
        total,
        items
      };

      fetch(TELEGRAM_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(res => res.text())
      .then(result => {
        alert("✔️ Order sent!");
      })
      .catch(err => {
        alert("❌ Failed to send.");
        console.error(err);
      });
    }

    renderProducts();
  </script>
</body>
</html>