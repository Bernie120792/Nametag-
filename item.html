<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BerniePOS</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px 0; display: flex; align-items: center; }
    .product img { width: 80px; height: 80px; margin-right: 15px; }
    .receipt { border: 1px dashed #000; padding: 15px; margin-top: 20px; background: #fff; }
    .btn { padding: 10px 20px; margin-top: 10px; cursor: pointer; }
    #qr { display: none; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #000; padding: 5px; text-align: left; }
  </style>
</head>
<body>
  <h1>BerniePOS</h1>

  <h3>Customer Info</h3>
  <input type="text" id="customerName" placeholder="Full Name"><br>
  <input type="tel" id="customerPhone" placeholder="Phone Number"><br>
  <textarea id="customerAddress" placeholder="Address"></textarea><br>

  <h3>Payment Method</h3>
  <label><input type="radio" name="paymentMethod" value="COD" checked onchange="toggleQR()"> COD</label>
  <label><input type="radio" name="paymentMethod" value="GCash" onchange="toggleQR()"> GCash</label>
  <div id="qr">
    <img src="https://via.placeholder.com/200x200.png?text=QRPH" alt="QR PH">
  </div>

  <h3>Products</h3>
  <div id="productContainer"></div>

  <h3>Cart</h3>
  <table id="cartTable">
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="btn" onclick="sendOrder()">Send to Telegram</button>

  <div class="receipt" id="receiptArea" style="display:none;"></div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzW4ZwSQQi_eaZAhVIrdTBPZP6MtPUZBozngK1HPp7DxNz5eSFUAFQU744AQK440Msyog/exec";

    const products = [
      { name: "Gulay Pack", price: 50, img: "https://via.placeholder.com/80?text=Gulay" },
      { name: "Suka", price: 25, img: "https://via.placeholder.com/80?text=Suka" },
      { name: "Toyo", price: 30, img: "https://via.placeholder.com/80?text=Toyo" },
    ];

    const cart = [];

    function toggleQR() {
      const payment = document.querySelector('input[name="paymentMethod"]:checked').value;
      document.getElementById('qr').style.display = (payment === "GCash") ? "block" : "none";
    }

    function addToCart(product) {
      const existing = cart.find(item => item.name === product.name);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({ ...product, qty: 1 });
      }
      updateCart();
    }

    function updateCart() {
      const tbody = document.querySelector("#cartTable tbody");
      tbody.innerHTML = "";
      cart.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${item.name}</td><td>${item.qty}</td><td>${item.price}</td><td>${item.qty * item.price}</td>`;
        tbody.appendChild(tr);
      });
    }

    function sendOrder() {
      const name = document.getElementById("customerName").value.trim();
      const phone = document.getElementById("customerPhone").value.trim();
      const address = document.getElementById("customerAddress").value.trim();
      const payment = document.querySelector('input[name="paymentMethod"]:checked').value;

      if (!name || !phone || !address || cart.length === 0) {
        alert("❗ Please fill all fields and add items.");
        return;
      }

      const orderText = `
📦 NEW ORDER
👤 Name: ${name}
📞 Phone: ${phone}
📍 Address: ${address}
💳 Payment: ${payment}
🛒 Items:
${cart.map(item => `• ${item.name} x${item.qty} = ₱${item.qty * item.price}`).join("\n")}
💰 Total: ₱${cart.reduce((t, i) => t + i.qty * i.price, 0)}
      `.trim();

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ message: orderText }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(() => {
        alert("✅ Order sent!");
        generateReceipt(name, phone, address, payment);
      })
      .catch(err => {
        alert("❌ Failed to send order.");
        console.error(err);
      });
    }

    function generateReceipt(name, phone, address, payment) {
      const div = document.getElementById("receiptArea");
      const total = cart.reduce((t, i) => t + i.qty * i.price, 0);
      div.innerHTML = `
        <h3>Resibo</h3>
        <p><strong>Name:</strong> ${name}<br>
        <strong>Phone:</strong> ${phone}<br>
        <strong>Address:</strong> ${address}<br>
        <strong>Payment:</strong> ${payment}</p>
        <table>
          <tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>
          ${cart.map(i => `<tr><td>${i.name}</td><td>${i.qty}</td><td>${i.price}</td><td>${i.qty * i.price}</td></tr>`).join("")}
        </table>
        <p><strong>Total: ₱${total}</strong></p>
      `;
      div.style.display = "block";
    }

    // Render products
    const container = document.getElementById("productContainer");
    products.forEach(p => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${p.img}">
        <div>
          <strong>${p.name}</strong><br>
          ₱${p.price}<br>
          <button onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
        </div>
      `;
      container.appendChild(div);
    });
  </script>
</body>
</html>