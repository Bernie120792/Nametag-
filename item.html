<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bernie POS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }
    #product-list > div {
      border: 1px solid #ccc;
      display: inline-block;
      margin: 10px;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }
    img {
      border-radius: 8px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: #f4f4f4;
      padding: 5px;
      margin: 5px 0;
      cursor: pointer;
    }
    button {
      padding: 5px 10px;
      margin-top: 5px;
    }
    input, textarea {
      padding: 8px;
      margin: 5px;
      width: 90%;
    }
    #receipt {
      border: 1px solid #aaa;
      padding: 10px;
      margin: 20px auto;
      max-width: 400px;
      background: #fff;
    }
  </style>
</head>
<body>
  <h2>Bernie POS</h2>

  <div>
    <input id="cust-name" placeholder="Customer Name" required><br>
    <input id="cust-phone" placeholder="Cellphone Number" required><br>
    <textarea id="cust-address" placeholder="Address" required></textarea>
  </div>

  <div id="product-list"></div>

  <div id="receipt">
    <h3>ðŸ§¾ Cart</h3>
    <ul id="cart"></ul>
    <p>Total: â‚±<span id="total">0</span></p>
    <input type="number" id="cash" placeholder="Enter Cash" />
    <p>Change: â‚±<span id="change">0</span></p>
  </div>

  <button onclick="sendOrder()">Send to Telegram + Save Receipt</button>

  <script>
    const productList = document.getElementById('product-list');
    const cartEl = document.getElementById('cart');
    const totalEl = document.getElementById('total');
    const changeEl = document.getElementById('change');
    const cashInput = document.getElementById('cash');
    const nameInput = document.getElementById('cust-name');
    const phoneInput = document.getElementById('cust-phone');
    const addressInput = document.getElementById('cust-address');

    let cart = [];

    const products = [
      { name: "Hotdog", price: 20, image: "https://via.placeholder.com/100" },
      { name: "Burger", price: 40, image: "https://via.placeholder.com/100" },
      { name: "Fries", price: 25, image: "https://via.placeholder.com/100" },
      { name: "Softdrinks", price: 15, image: "https://via.placeholder.com/100" },
      { name: "Spaghetti", price: 30, image: "https://via.placeholder.com/100" },
      { name: "Siomai", price: 10, image: "https://via.placeholder.com/100" },
      { name: "Rice Meal", price: 50, image: "https://via.placeholder.com/100" },
      { name: "Juice", price: 10, image: "https://via.placeholder.com/100" }
    ];

    products.forEach(prod => {
      const div = document.createElement('div');
      div.innerHTML = `
        <img src="${prod.image}" width="100"><br>
        <strong>${prod.name}</strong><br>
        â‚±${prod.price}<br>
        <button onclick='addToCart("${prod.name}", ${prod.price})'>Add</button>
      `;
      productList.appendChild(div);
    });

    function addToCart(name, price) {
      cart.push({ name, price });
      renderCart();
    }

    function renderCart() {
      cartEl.innerHTML = "";
      let total = 0;
      cart.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - â‚±${item.price}`;
        li.onclick = () => { cart.splice(i, 1); renderCart(); };
        cartEl.appendChild(li);
        total += item.price;
      });
      totalEl.textContent = total;
      updateChange();
    }

    cashInput.addEventListener('input', updateChange);
    function updateChange() {
      const total = parseFloat(totalEl.textContent);
      const cash = parseFloat(cashInput.value || 0);
      changeEl.textContent = (cash - total) >= 0 ? (cash - total) : 0;
    }

    function sendOrder() {
      if (!nameInput.value || !phoneInput.value || !addressInput.value) {
        alert("Please fill in customer details.");
        return;
      }

      const orderText = cart.map(i => `${i.name} - â‚±${i.price}`).join("\n");
      const total = totalEl.textContent;
      const cash = cashInput.value;
      const change = changeEl.textContent;

      const msg = `ðŸ§¾ NEW ORDER\nðŸ‘¤ Name: ${nameInput.value}\nðŸ“± Phone: ${phoneInput.value}\nðŸ  Address: ${addressInput.value}\n\n${orderText}\n\nTotal: â‚±${total}\nCash: â‚±${cash}\nChange: â‚±${change}`;
      sendToTelegram(msg);
      saveReceiptImage();
    }

    function sendToTelegram(message) {
      const telegramBotToken = "7619625107:AAENHMSvD5cPL6z_9BOz5HpXJUDs7gC75NQ";
      const telegramChatId = "8016868219";

      const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
      const data = {
        chat_id: telegramChatId,
        text: message
      };

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(() => {
        alert("âœ… Order sent to Telegram!");
        clearAll();
      });
    }

    function saveReceiptImage() {
      html2canvas(document.getElementById("receipt")).then(canvas => {
        const link = document.createElement("a");
        link.download = "receipt.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    function clearAll() {
      cart = [];
      renderCart();
      cashInput.value = '';
      changeEl.textContent = '0';
      nameInput.value = '';
      phoneInput.value = '';
      addressInput.value = '';
    }
  </script>
</body>
</html>