<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Balance Checker</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f8f9fa;
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #loginPanel {
    background: #fff;
    padding: 20px 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
  }

  input[type="password"] {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }

  #balanceBox {
    background-color: #8e44ad;
    border-radius: 15px;
    padding: 20px;
    font-size: 16px;
    color: white;
    display: flex;
    flex-direction: column;
    position: relative;
    width: 220px;
    text-align: center;
  }

  .label {
    font-weight: bold;
    font-size: 14px;
    margin-bottom: 5px;
  }

  .value {
    font-size: 22px;
    font-weight: bold;
  }

  .eye-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 20px;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Login -->
<div id="loginPanel">
  <h2>Secure Login</h2>
  <input type="password" id="mpin" placeholder="Enter your MPIN" />
  <button onclick="login()">Login</button>
</div>

<!-- Balance Page -->
<div id="balancePanel" style="display:none;">
  <div id="balanceBox">
    <div class="label">BALANCE</div>
    <div class="value" id="balance">‚Ç±0</div>
    <button class="eye-icon" onclick="toggleBalance()">üëÅ</button>
  </div>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbxvZqeJpZtVAGFNOKhdFSj6DIwaerJ7t0W4m7BT5-EzM3x8CsWHa--x-gbSWepWRh5G/exec";
  let savedMPIN = "";
  let balanceVisible = true;

  window.onload = function() {
    const storedMPIN = localStorage.getItem("mpin");
    if (storedMPIN) {
      savedMPIN = storedMPIN;
      document.getElementById("loginPanel").style.display = "none";
      document.getElementById("balancePanel").style.display = "block";
      loadBalance();
    }
  };

  function login() {
    const mpin = document.getElementById("mpin").value.trim();
    if (!mpin) { alert("‚ö†Ô∏è Please enter your MPIN."); return; }
    savedMPIN = mpin;
    localStorage.setItem("mpin", mpin);
    document.getElementById("loginPanel").style.display = "none";
    document.getElementById("balancePanel").style.display = "block";
    loadBalance();
  }

  function loadBalance() {
    const balanceEl = document.getElementById("balance");
    balanceEl.textContent = "Checking...";
    fetch(scriptURL, {
      method: "POST",
      body: new URLSearchParams({ mpin: savedMPIN }),
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        balanceEl.dataset.real = data.balance; // save real balance
        balanceEl.textContent = `‚Ç±${data.balance}`;
      } else {
        alert("‚ùå " + data.message);
        // logout(); // optional, no logout now
      }
    })
    .catch(err => {
      console.error(err);
      alert("‚ö†Ô∏è Connection error.");
      // logout(); // optional, no logout now
    });
  }

  function toggleBalance() {
    const balanceEl = document.getElementById("balance");
    balanceVisible = !balanceVisible;
    balanceEl.textContent = balanceVisible ? `‚Ç±${balanceEl.dataset.real || "0"}` : "****";
  }
</script>

</body>
</html>